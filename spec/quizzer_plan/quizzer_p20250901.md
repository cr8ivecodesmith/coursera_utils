Quizzer UI — Next Steps
=======================

Purpose
-------
Stabilize the Textual UI so it consistently renders:
- Initial question + footer without any user input.
- Submit confirmation (Yes/No) that visibly updates the footer.
- A summary page with pagination (5 items/page) navigable via Prev/Next.


Observed Issues
---------------
- Only the footer renders; the main stage is blank on load.
- A horizontal scrollbar appears (footer likely overflows horizontally).
- Submit didn’t toggle the footer to the confirmation state.


Likely Causes
-------------
- Layout: docked footer combined with unconstrained main content can collapse the stage to zero height.
- Lifecycle: relying only on compose() can defer painting until a later event; on_mount() should trigger first render.
- Version drift: Horizontal may be absent in some Textual versions (NameError), aborting compose mid‑way.


Plan (clean, predictable rendering)
-----------------------------------
1) Layout (explicit, no docks initially)
   - Top-level Vertical#root with two children:
     - Container#stage (CSS: height: 1fr) — expands to fill space.
     - Container#footer (CSS: height: auto) — fixed-height footer.
   - Avoid dock: bottom until layout is stable.

2) Deterministic initial paint
   - In compose(), create empty #stage and #footer under #root.
   - Add on_mount() that calls _update_stage() then _render_footer() to paint DOM once mounted.

3) Footer content (horizontal)
   - Quiz mode: Prev, Next, Submit, Answered X/Y.
   - Confirm mode: "Submit answers?", Yes, No, Answered X/Y.
   - Summary mode: Prev Page, Next Page, Page A/B.
   - Horizontal shim for compatibility:
     ```python
     try:
         from textual.containers import Vertical, Horizontal, Container
     except Exception:
         from textual.containers import Vertical, Container
         class Horizontal(Container):
             pass
     ```

4) QuizApp state
   - _mode: Literal["quiz","confirm","summary"] = "quiz"
   - _summary: list[dict] = []
   - _sum_page: int = 0
   - select_answer(): update _selected; call _update_stage().
   - action_submit(): _mode = "confirm"; _render_footer().
   - action_confirm_yes(): build _summary via summarize_results, set _mode = "summary" and _sum_page = 0; _update_stage(); _render_footer().
   - action_confirm_no(): _mode = "quiz"; _render_footer().
   - next_question()/prev_question(): page in summary mode; otherwise change index; always _update_stage().

5) Stage renderer (_update_stage)
   - Quiz/Confirm: mount QuestionView; try to update footer counter (#answered). If confirm, call _render_footer() to ensure Yes/No is visible.
   - Summary: clear stage; mount header "Score: correct/total • Page n/N"; then 5 rows of "✓|✗ stem" based on _sum_page.

6) CSS starters
   - #root { height: 100%; }
   - #stage { height: 1fr; }
   - #footer { height: auto; }
   - #choices Button.selected { background: $accent; color: black; }


Step-by-step Implementation
---------------------------
1) Add the Horizontal shim in imports (see above).
2) Add/replace CSS in QuizApp.CSS with the "CSS starters".
3) In compose():
   ```python
   with Vertical(id="root"):
       with Container(id="stage"):
           pass
       with Container(id="footer"):
           pass
   ```
4) Add on_mount(): call _update_stage(); _render_footer().
5) Implement _render_footer() to rebuild footer per _mode with a Horizontal row.
6) Update _update_stage() to render question vs summary per _mode.
7) Wire submit/confirm actions and summary pagination (5 items/page).


Validation Checklist
--------------------
- On start: question visible + footer visible; no horizontal scroll.
- Submit: footer changes to Yes/No; stage remains visible.
- Confirm Yes: summary header + 5 rows; Prev/Next paginate pages.
- Confirm No: footer returns to quiz controls.
- Selecting an answer updates "Answered X/Y" immediately.


If issues persist
-----------------
1) Add debug prints in on_mount(), _update_stage(), _render_footer() to confirm they fire.
2) Temporarily render a Static in #stage to isolate QuestionView issues.
3) Replace Horizontal with a simple Container of Buttons to rule out Horizontal layout problems.
4) Strip CSS to only #stage { height: 1fr; } while testing; reintroduce rules gradually.
5) Test an ultra-minimal app using Vertical + two Containers to verify environment.


Relevant Docs
-------------
- Textual Layout & Containers: Vertical, Container sizing, fraction heights (1fr).
- Textual CSS Reference: height, layout, and docking semantics.
- Textual App Lifecycle: compose(), on_mount(), DOM querying (query_one).
- Widgets: Button, Static; using mount() and remove_children().


Contingency (short term)
------------------------
- Provide a CLI summary path (no UI) to validate summarize_results and pagination while UI stabilizes.


Post‑stabilization Enhancements
-------------------------------
- Show selected vs correct letters in summary rows.
- Add a "Back to Quiz" button in summary mode.
- Persist session responses and show per-topic stats.
- Add a keybindings hint bar / help screen.
